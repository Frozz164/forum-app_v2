{"ast":null,"code":"var _jsxFileName = \"E:\\\\forum-app_v2\\\\forum-react-frontend\\\\src\\\\components\\\\Chat.jsx\",\n  _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chat({\n  token,\n  user\n}) {\n  _s();\n  var _socketRef$current;\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState('');\n  const socketRef = useRef(null);\n  useEffect(() => {\n    if (!token) {\n      console.error('Token is missing!');\n      return;\n    }\n    const socket = new WebSocket(`ws://localhost:8081/ws?token=${token}`);\n    socketRef.current = socket;\n    socket.onopen = () => {\n      console.log('WebSocket connected');\n      // Запросите историю сообщений при подключении\n      socket.send(JSON.stringify({\n        Type: 2,\n        // 2 - запрос истории\n        UserID: user === null || user === void 0 ? void 0 : user.id\n      }));\n    };\n    socket.onmessage = e => {\n      const msg = JSON.parse(e.data);\n      setMessages(prev => [...prev, msg]);\n    };\n    socket.onerror = e => {\n      console.error('WebSocket error:', e);\n    };\n    return () => {\n      if (socket.readyState === WebSocket.OPEN) {\n        socket.close();\n      }\n    };\n  }, [token, user === null || user === void 0 ? void 0 : user.id]);\n  const sendMessage = () => {\n    if (!socketRef.current || socketRef.current.readyState !== WebSocket.OPEN) {\n      console.error('WebSocket not connected');\n      return;\n    }\n    socketRef.current.send(JSON.stringify({\n      Content: message,\n      Type: 1,\n      // 1 - обычное сообщение\n      Sender: (user === null || user === void 0 ? void 0 : user.username) || 'Guest',\n      UserID: (user === null || user === void 0 ? void 0 : user.id) || 0\n    }));\n    setMessage('');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Chat\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages\",\n      children: messages.map((msg, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"message\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: [msg.Sender, \":\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 25\n        }, this), \" \", msg.Content]\n      }, i, true, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      value: message,\n      onChange: e => setMessage(e.target.value),\n      onKeyPress: e => e.key === 'Enter' && sendMessage()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: sendMessage,\n      children: \"Send\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"Status: \", ((_socketRef$current = socketRef.current) === null || _socketRef$current === void 0 ? void 0 : _socketRef$current.readyState) === WebSocket.OPEN ? 'Connected' : 'Disconnected']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 9\n  }, this);\n}\n_s(Chat, \"dmRqlSI64A09RUe46AA7mFuxfZI=\");\n_c = Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["useState","useEffect","useRef","jsxDEV","_jsxDEV","Chat","token","user","_s","_socketRef$current","messages","setMessages","message","setMessage","socketRef","console","error","socket","WebSocket","current","onopen","log","send","JSON","stringify","Type","UserID","id","onmessage","e","msg","parse","data","prev","onerror","readyState","OPEN","close","sendMessage","Content","Sender","username","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","i","value","onChange","target","onKeyPress","key","onClick","_c","$RefreshReg$"],"sources":["E:/forum-app_v2/forum-react-frontend/src/components/Chat.jsx"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\n\r\nexport default function Chat({ token, user }) {\r\n    const [messages, setMessages] = useState([]);\r\n    const [message, setMessage] = useState('');\r\n    const socketRef = useRef(null);\r\n\r\n    useEffect(() => {\r\n        if (!token) {\r\n            console.error('Token is missing!');\r\n            return;\r\n        }\r\n\r\n        const socket = new WebSocket(`ws://localhost:8081/ws?token=${token}`);\r\n        socketRef.current = socket;\r\n\r\n        socket.onopen = () => {\r\n            console.log('WebSocket connected');\r\n            // Запросите историю сообщений при подключении\r\n            socket.send(JSON.stringify({\r\n                Type: 2, // 2 - запрос истории\r\n                UserID: user?.id\r\n            }));\r\n        };\r\n\r\n        socket.onmessage = (e) => {\r\n            const msg = JSON.parse(e.data);\r\n            setMessages(prev => [...prev, msg]);\r\n        };\r\n\r\n        socket.onerror = (e) => {\r\n            console.error('WebSocket error:', e);\r\n        };\r\n\r\n        return () => {\r\n            if (socket.readyState === WebSocket.OPEN) {\r\n                socket.close();\r\n            }\r\n        };\r\n    }, [token, user?.id]);\r\n\r\n    const sendMessage = () => {\r\n        if (!socketRef.current || socketRef.current.readyState !== WebSocket.OPEN) {\r\n            console.error('WebSocket not connected');\r\n            return;\r\n        }\r\n\r\n        socketRef.current.send(JSON.stringify({\r\n            Content: message,\r\n            Type: 1, // 1 - обычное сообщение\r\n            Sender: user?.username || 'Guest',\r\n            UserID: user?.id || 0\r\n        }));\r\n        setMessage('');\r\n    };\r\n\r\n    return (\r\n        <div className=\"chat-container\">\r\n            <h3>Chat</h3>\r\n            <div className=\"messages\">\r\n                {messages.map((msg, i) => (\r\n                    <div key={i} className=\"message\">\r\n                        <strong>{msg.Sender}:</strong> {msg.Content}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            <input\r\n                value={message}\r\n                onChange={(e) => setMessage(e.target.value)}\r\n                onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\r\n            />\r\n            <button onClick={sendMessage}>Send</button>\r\n            <div>Status: {socketRef.current?.readyState === WebSocket.OPEN ? 'Connected' : 'Disconnected'}</div>\r\n        </div>\r\n    );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}